# Домашнее задание к занятию "`Уязвимости и атаки на информационные системы`" - `Потапов Василий`


## Задание 1

Скачайте и установите виртуальную машину Metasploitable: https://sourceforge.net/projects/metasploitable/.

Это типовая ОС для экспериментов в области информационной безопасности, с которой следует начать при анализе уязвимостей.

Просканируйте эту виртуальную машину, используя nmap.

Попробуйте найти уязвимости, которым подвержена эта виртуальная машина.

Сами уязвимости можно поискать на сайте https://www.exploit-db.com/.

Для этого нужно в поиске ввести название сетевой службы, обнаруженной на атакуемой машине, и выбрать подходящие по версии уязвимости.

Ответьте на следующие вопросы:

Какие сетевые службы в ней разрешены?
Какие уязвимости были вами обнаружены? (список со ссылками: достаточно трёх уязвимостей)
Приведите ответ в свободной форме.

### Ответ 1

![Название скриншота 1](https://github.com/mistermedved01/hw-13-01/blob/main/img/nmap_metasploitable.jpg)

## Основы Unix

TCP-порты 512, 513 и 514 известны как службы "r" и были неправильно настроены для разрешения удаленного доступа с любого хоста

Порт 2049 - это сетевая файловая система (NFS). NFS можно определить, прощупав порт 2049 напрямую или запросив список служб у portmapper. Приведенный ниже пример используется для идентификации NFS и определения того, что общий ресурс "/" (корень файловой системы) экспортируется.
Получить доступ к системе с такой записываемой файловой системой тривиально. Для этого (и поскольку SSH работает), мы сгенерируем новый ключ SSH в нашей атакующей системе, смонтируем экспорт NFS и добавим наш ключ в authorized_keys файл учетной записи пользователя root.

## Бэкдоры

На порту 21 Metasploitable2 запускает vsftpd, популярный FTP-сервер. Именно эта версия содержит бэкдор, который был внедрен в исходный код неизвестным злоумышленником. Бэкдор был быстро идентифицирован и удален, но не раньше, чем его скачало довольно много людей. Если будет отправлено имя пользователя, которое оканчивается на последовательность [ a happy face ], версия с бэкдором откроет оболочку прослушивания на порту 6200. Мы можем продемонстрировать это с помощью telnet или использовать модуль Metasploit Framework для автоматического использования этой уязвимости

На порту 6667 Metasploitable2 запускает IRC-демон UnreaIRCD. Эта версия содержит бэкдор, который оставался незамеченным в течение нескольких месяцев - срабатывал путем отправки букв "AB" с последующей системной командой на сервер на любом прослушивающем порту. В Metasploit есть модуль, использующий эту уязвимость для получения интерактивной оболочки.

Старый резервный бэкдор "ingreslock", который прослушивает порт 1524. Порт ingreslock был популярным выбором десять лет назад для добавления бэкдора на скомпрометированный сервер. Получить к нему доступ очень просто.

## Непреднамеренные бэкдоры

Помимо вредоносных бэкдоров из предыдущего раздела, некоторые сервисы по своей природе являются чуть ли не бэкдорами. Первым из них, установленным на Metasploitable2, является distccd. Эта программа упрощает масштабирование больших заданий компилятора в ферме систем с одинаковой конфигурацией. Проблема с этим сервисом заключается в том, что злоумышленник может легко злоупотребить им, чтобы выполнить команду по своему выбору, как показано на примере использования модуля Metasploit ниже.

Samba, если она настроена с возможностью записи и включена функция «широких ссылок» (по умолчанию включена), также может использоваться в качестве своего рода бэкдора для доступа к файлам, которые не предназначены для совместного использования. В приведенном ниже примере модуль Metasploit используется для предоставления доступа к корневой файловой системе с помощью анонимного соединения и общего ресурса, доступного для записи.

## Слабые пароли

В дополнение к более вопиющим бэкдорам и неправильной конфигурации, Metasploitable 2 имеет ужасную защиту паролей как для системных учетных записей, так и для учетных записей серверов баз данных. Пароль основного пользователя с правами администратора совпадает с именем пользователя. Обнаружив список пользователей в этой системе, либо используя другую уязвимость для захвата файла passwd, либо перечислив эти идентификаторы пользователей с помощью Samba, можно использовать атаку грубой силы для быстрого доступа к нескольким учетным записям пользователей. Как минимум, в системе настроены следующие слабые системные учетные записи - msfadmin

В дополнение к этим учетным записям системного уровня, доступ к сервису PostgreSQL можно получить с помощью имени пользователя и пароля, в то время как сервис MySQL открыт для имени пользователя с пустым паролем. Сервис VNC предоставляет удаленный доступ к рабочему столу по паролю postgres postgres root password

## Эксплоиты

1. https://www.exploit-db.com/exploits/17491
2. https://www.exploit-db.com/exploits/30020
3. https://www.exploit-db.com/exploits/6122

## Задание 2

Проведите сканирование Metasploitable в режимах SYN, FIN, Xmas, UDP.

Запишите сеансы сканирования в Wireshark.

Ответьте на следующие вопросы:

Чем отличаются эти режимы сканирования с точки зрения сетевого трафика?
Как отвечает сервер?
Приведите ответ в свободной форме.

## Ответ 2

Эти режимы сканирования используются в технологии сканирования портов сетевых устройств с целью выявления открытых портов и уязвимостей.

SYN-сканирование: это наиболее распространенный метод сканирования, при котором сканер отправляет запрос SYN на целевой порт. Если порт закрыт, то целевой хост отсылает ответ RST, а если порт открыт, то хост отсылает ответ SYN/ACK. Ответ SYN/ACK является сигналом для сканера, что порт открыт, и он заносит это в свой список.

FIN-сканирование: при этом методе сканирования сканер отправляет пакет FIN на целевой порт. Если порт закрыт, то хост игнорирует пакет, а если порт открыт, то хост отсылает пакет RST, что также указывает на открытый порт.
Xmas-сканирование: это расширение метода FIN-сканирования, при котором сканер отправляет пакет, включающий флаги FIN, URG и PSH. Если порт закрыт, то хост игнорирует пакет, а если порт открыт, то хост отсылает пакет RST, что также указывает на открытый порт.

UDP-сканирование: этот метод сканирования используется для сканирования портов, которые работают с протоколом UDP. В отличие от TCP, протокол UDP не поддерживает установление соединения, поэтому при сканировании порта UDP сканер отправляет запрос на целевой порт, а если порт закрыт, то хост отсылает ответ ICMP port unreachable.

В целом, все эти методы сканирования используются для обнаружения уязвимостей и открытых портов на сетевых устройствах, но они отличаются по способу отправки запросов и обработке ответов. Кроме того, существуют различные методы защиты от таких атак, например, могут быть настроены файрволы и системы обнаружения вторжений, которые могут блокировать подозрительный трафик.

Как отвечает сервер?

При сканировании в режиме SYN отправляется серия пакетов с установленным только флагом SYN, без установки флагов ACK и FIN. Если порт открыт, то сервер должен ответить пакетом с установленными флагами SYN и ACK.

При сканировании в режиме FIN отправляется пакет с установленным флагом FIN. Если порт закрыт, то сервер должен ответить пакетом с установленным флагом RST (сброс соединения).

При сканировании в режиме Xmas отправляется пакет с установленными флагами FIN, PSH и URG. Если порт закрыт, то сервер должен ответить пакетом с установленным флагом RST.

При сканировании UDP отправляются пакеты с произвольным содержимым на случайный порт. Если порт закрыт, то сервер должен ответить пакетом с установленным флагом ICMP Destination Unreachable. Однако, если порт открыт, то сервер может не отвечать на такие пакеты вообще.


